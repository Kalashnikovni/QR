<!DOCTYPE html>
<html lang="es">
<meta charset="UTF-8" />
  <title>Encuesta Interactiva</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: linear-gradient(-45deg, #f9f9f9, #e1f5fe, #fff3e0, #fce4ec);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      text-align: center;
      padding: 30px;
    }

    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    h1 {
      color: #333;
      margin-bottom: 30px;
      font-size: 32px;
    }

    #question-text {
      font-size: 24px;
      margin-bottom: 30px;
      color: #444;
    }

    .option-container {
      margin: 15px auto;
      width: 95%;
      max-width: 600px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: transform 0.2s;
    }

    .option-container:hover {
      transform: scale(1.02);
    }

    .option {
      cursor: pointer;
      font-size: 20px;
      padding: 20px;
      border-bottom: 1px solid #eee;
      background-color: #fff;
    }

    .option:last-child {
      border-bottom: none;
    }

    .option:hover {
      background-color: #e0f7fa;
    }

    .disabled {
      pointer-events: none;
      opacity: 0.6;
    }

    .progress-bar {
      height: 24px;
      background: #4dd0e1;
      border-radius: 0 0 16px 16px;
      color: white;
      font-size: 14px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: width 0.4s;
    }

    #next-btn {
      margin-top: 40px;
      padding: 20px;
      font-size: 20px;
      font-weight: bold;
      background-color: #4db6ac;
      color: white;
      border: none;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    #next-btn:hover {
      background-color: #00897b;
    }

    #qr-code {
      margin-top: 50px;
    }
  </style>
</head>
<body>
  <h1>Encuesta Interactiva</h1>
  <div id="question-text">Cargando pregunta...</div>
  <div id="options"></div>
  <button id="next-btn">Siguiente pregunta</button>
  <div id="qr-code"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
    
    // Tu configuración Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCsYSsb-PsxTCKihp7ROVJsdBSFX3dMd2w",
      authDomain: "poll-e8e49.firebaseapp.com",
      databaseURL: "https://poll-e8e49-default-rtdb.firebaseio.com",
      projectId: "poll-e8e49",
      storageBucket: "poll-e8e49.firebasestorage.app",
      messagingSenderId: "957719245646",
      appId: "1:957719245646:web:490403f5587901efcde41f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const questions = [
      {
        question: "¿Cuál es tu color favorito?",
        options: ["Rojo", "Azul", "Verde", "Amarillo"],
      },
      {
        question: "¿Cuál es tu animal favorito?",
        options: ["Perro", "Gato", "Pez", "Pájaro"],
      },
      {
        question: "¿Cuál es tu estación favorita?",
        options: ["Verano", "Invierno", "Otoño", "Primavera"],
      },
    ];

    let current = 0;
    const questionText = document.getElementById("question-text");
    const optionsDiv = document.getElementById("options");
    const nextBtn = document.getElementById("next-btn");

    function showQuestion() {
      const q = questions[current];
      questionText.textContent = q.question;
      optionsDiv.innerHTML = "";

      q.options.forEach((opt) => {
        const div = document.createElement("div");
        div.className = "option";
        div.textContent = opt;

        const progress = document.createElement("div");
        progress.className = "progress-bar";
        progress.style.width = "0%";

        const container = document.createElement("div");
        container.className = "option-container";
        container.appendChild(div);
        container.appendChild(progress);

        div.addEventListener("click", () => vote(opt));

        optionsDiv.appendChild(container);
      });

      nextBtn.style.display = "none";
    }

    function vote(option) {
      const qKey = `q${current}`;
      const voteRef = ref(db, `votes/${qKey}/${option}`);

      runTransaction(voteRef, (currentValue) => {
        return (currentValue || 0) + 1;
      }).then(() => {
        document.querySelectorAll(".option").forEach((el) => {
          el.classList.add("disabled");
          if (el.textContent === option) {
            el.style.backgroundColor = "#b2ebf2";
          }
        });
        nextBtn.style.display = current < questions.length - 1 ? "inline-block" : "none";
      });
    }

    function updateVotesDisplay(votes) {
      const qKey = `q${current}`;
      if (!votes || !votes[qKey]) return;

      const total = Object.values(votes[qKey]).reduce((a, b) => a + b, 0);
      if (total === 0) return;

      document.querySelectorAll(".option-container").forEach((container) => {
        const label = container.querySelector(".option").textContent;
        const count = votes[qKey][label] || 0;
        const percent = ((count / total) * 100).toFixed(1);

        const bar = container.querySelector(".progress-bar");
        bar.style.width = percent + "%";
        bar.textContent = percent + "%";
      });
    }

    // Listener para los votos en Firebase
    const votesRef = ref(db, "votes");
    onValue(votesRef, (snapshot) => {
      const votes = snapshot.val();
      updateVotesDisplay(votes);
    });


    nextBtn.addEventListener("click", () => {
      current++;
      if (current < questions.length) {
        showQuestion();
      }
    });

    showQuestion();
  </script>
</body>
</html>
